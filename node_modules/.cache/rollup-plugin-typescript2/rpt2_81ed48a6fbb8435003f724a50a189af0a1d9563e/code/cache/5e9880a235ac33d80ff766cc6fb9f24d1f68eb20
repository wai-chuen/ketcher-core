{"code":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\n// todo: rename file in another PR\r\nimport { StereLabelStyleType } from '../../render';\r\nclass BaseOperation {\r\n    // eslint-disable-next-line no-use-before-define\r\n    _inverted;\r\n    type;\r\n    priority;\r\n    data;\r\n    constructor(type, priority = 0) {\r\n        this.type = type;\r\n        this.priority = priority;\r\n    }\r\n    execute(_restruct) {\r\n        throw new Error('Operation.execute() is not implemented');\r\n    }\r\n    perform(restruct) {\r\n        this.execute(restruct);\r\n        if (!this._inverted) {\r\n            this._inverted = this.invert();\r\n            this._inverted._inverted = this;\r\n        }\r\n        return this._inverted;\r\n    }\r\n    invert() {\r\n        throw new Error('Operation.invert() is not implemented');\r\n    }\r\n    isDummy(_restruct) {\r\n        return false;\r\n    }\r\n    static invalidateAtom(restruct, atomId, level) {\r\n        const atom = restruct.atoms.get(atomId);\r\n        if (!atom) {\r\n            return;\r\n        }\r\n        restruct.markAtom(atomId, level ? 1 : 0);\r\n        const halfBonds = restruct.molecule.halfBonds;\r\n        atom.a.neighbors.forEach((halfBondId) => {\r\n            if (!halfBonds.has(halfBondId)) {\r\n                return;\r\n            }\r\n            const halfBond = halfBonds.get(halfBondId);\r\n            if (!halfBond) {\r\n                return;\r\n            }\r\n            restruct.markBond(halfBond.bid, 1);\r\n            restruct.markAtom(halfBond.end, 0);\r\n            if (level) {\r\n                BaseOperation.invalidateLoop(restruct, halfBond.bid);\r\n            }\r\n        });\r\n        const fragment = atom.a.fragment;\r\n        const stereoLabelStyle = restruct.render.options.stereoLabelStyle;\r\n        restruct.atoms.forEach((atom, atomId) => {\r\n            if (stereoLabelStyle === StereLabelStyleType.IUPAC ||\r\n                stereoLabelStyle === StereLabelStyleType.Classic) {\r\n                if (atom.a.fragment === fragment)\r\n                    restruct.markAtom(atomId, 0);\r\n            }\r\n        });\r\n    }\r\n    static invalidateLoop(restruct, bondId) {\r\n        const bond = restruct.bonds.get(bondId);\r\n        if (!bond || !bond.b.hb1 || !bond.b.hb2) {\r\n            return;\r\n        }\r\n        const halfBond1 = restruct.molecule.halfBonds.get(bond.b.hb1);\r\n        const halfBond2 = restruct.molecule.halfBonds.get(bond.b.hb2);\r\n        if (halfBond1 && halfBond1.loop >= 0) {\r\n            restruct.loopRemove(halfBond1.loop);\r\n        }\r\n        if (halfBond2 && halfBond2.loop >= 0) {\r\n            restruct.loopRemove(halfBond2.loop);\r\n        }\r\n    }\r\n    static invalidateBond(restruct, bondId) {\r\n        BaseOperation.invalidateLoop(restruct, bondId);\r\n        const bond = restruct.bonds.get(bondId);\r\n        if (!bond) {\r\n            return;\r\n        }\r\n        BaseOperation.invalidateAtom(restruct, bond.b.begin, 0);\r\n        BaseOperation.invalidateAtom(restruct, bond.b.end, 0);\r\n    }\r\n    static invalidateItem(restruct, map, id, level) {\r\n        if (map === 'atoms') {\r\n            BaseOperation.invalidateAtom(restruct, id, level);\r\n            return;\r\n        }\r\n        if (map === 'bonds') {\r\n            BaseOperation.invalidateBond(restruct, id);\r\n            if (level > 0) {\r\n                BaseOperation.invalidateLoop(restruct, id);\r\n            }\r\n            return;\r\n        }\r\n        restruct.markItem(map, id, level);\r\n    }\r\n    static invalidateEnhancedFlag(restruct, fragmentId) {\r\n        BaseOperation.invalidateItem(restruct, 'enhancedFlags', fragmentId, 1);\r\n    }\r\n}\r\nexport { BaseOperation };\r\nexport default BaseOperation;\r\n//# sourceMappingURL=base.js.map","references":["/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/src/application/render/index.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/src/application/editor/operations/OperationType.ts"],"map":"{\"version\":3,\"file\":\"base.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/application/editor/operations/base.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/node_modules/.cache/rollup-plugin-typescript2/placeholder/application/editor/operations/base.d.ts","writeByteOrderMark":false,"text":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { ReStruct } from '../../render';\r\nimport { OperationType } from './OperationType';\r\ndeclare type ValueOf<TObject extends object> = Readonly<TObject[keyof TObject]>;\r\ndeclare type OperationType = ValueOf<typeof OperationType>;\r\ndeclare class BaseOperation {\r\n    private _inverted;\r\n    type: OperationType;\r\n    priority: number;\r\n    data: any;\r\n    constructor(type: OperationType, priority?: number);\r\n    execute(_restruct: ReStruct): void;\r\n    perform(restruct: ReStruct): BaseOperation;\r\n    invert(): BaseOperation;\r\n    isDummy(_restruct: ReStruct): boolean;\r\n    protected static invalidateAtom(restruct: ReStruct, atomId: number, level?: any): void;\r\n    protected static invalidateLoop(restruct: ReStruct, bondId: number): void;\r\n    protected static invalidateBond(restruct: ReStruct, bondId: number): void;\r\n    protected static invalidateItem(restruct: ReStruct, map: any, id: number, level?: any): void;\r\n    protected static invalidateEnhancedFlag(restruct: ReStruct, fragmentId: number): void;\r\n}\r\nexport { BaseOperation };\r\nexport default BaseOperation;\r\n"}}
