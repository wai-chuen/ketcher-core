{"code":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport Base from '../base';\r\nimport { OperationType } from '../OperationType';\r\nimport { Scale } from \"../../../../domain/helpers\";\r\nimport { RxnArrow } from \"../../../../domain/entities\";\r\nimport { tfx } from \"../../../../utilities\";\r\nexport class RxnArrowResize extends Base {\r\n    data;\r\n    constructor(id, d, current, anchor, noinvalidate) {\r\n        super(OperationType.RXN_ARROW_RESIZE);\r\n        this.data = { id, d, current, anchor, noinvalidate };\r\n    }\r\n    execute(restruct) {\r\n        const struct = restruct.molecule;\r\n        const id = this.data.id;\r\n        const d = this.data.d;\r\n        const current = this.data.current;\r\n        const item = struct.rxnArrows.get(id);\r\n        const anchor = this.data.anchor;\r\n        if (anchor) {\r\n            const previousPos0 = item.pos[0].get_xy0();\r\n            const previousPos1 = item.pos[1].get_xy0();\r\n            let middlePoint;\r\n            let reItem;\r\n            if (RxnArrow.isElliptical(item)) {\r\n                reItem = restruct.rxnArrows.get(id);\r\n                [, , middlePoint] = reItem.getReferencePoints();\r\n            }\r\n            if (tfx(anchor.x) === tfx(item.pos[1].x) &&\r\n                tfx(anchor.y) === tfx(item.pos[1].y)) {\r\n                item.pos[1].x = anchor.x = current.x;\r\n                current.x = previousPos1.x;\r\n                item.pos[1].y = anchor.y = current.y;\r\n                current.y = previousPos1.y;\r\n            }\r\n            if (tfx(anchor.x) === tfx(item.pos[0].x) &&\r\n                tfx(anchor.y) === tfx(item.pos[0].y)) {\r\n                item.pos[0].x = anchor.x = current.x;\r\n                current.x = previousPos0.x;\r\n                item.pos[0].y = anchor.y = current.y;\r\n                current.y = previousPos0.y;\r\n            }\r\n            if (tfx(anchor.x) === tfx(middlePoint?.x) &&\r\n                tfx(anchor.y) === tfx(middlePoint?.y)) {\r\n                const { angle } = reItem.getArrowParams(item.pos[0].x, item.pos[0].y, item.pos[1].x, item.pos[1].y);\r\n                const angleInRadians = (angle * Math.PI) / 180;\r\n                const cosAngle = Math.cos(angleInRadians);\r\n                const sinAngle = Math.sin(angleInRadians);\r\n                const diffX = current.x - anchor.x;\r\n                const diffY = current.y - anchor.y;\r\n                const diff = diffY * cosAngle - diffX * sinAngle;\r\n                item.height -= diff;\r\n                const [, , newMiddlePoint] = reItem.getReferencePoints();\r\n                anchor.y = newMiddlePoint.y;\r\n                anchor.x = newMiddlePoint.x;\r\n            }\r\n        }\r\n        else {\r\n            item.pos[1].add_(d);\r\n        }\r\n        restruct.rxnArrows\r\n            .get(id)\r\n            .visel.translate(Scale.obj2scaled(d, restruct.render.options));\r\n        this.data.d = d.negated();\r\n        if (!this.data.noinvalidate) {\r\n            Base.invalidateItem(restruct, 'rxnArrows', id, 1);\r\n        }\r\n    }\r\n    invert() {\r\n        return new RxnArrowResize(this.data.id, this.data.d, this.data.current, this.data.anchor, this.data.noinvalidate);\r\n    }\r\n}\r\n//# sourceMappingURL=RxnArrowResize.js.map","references":["/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/src/application/editor/operations/base.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/src/application/editor/operations/OperationType.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/src/domain/helpers/index.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/src/domain/entities/index.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/src/utilities/index.ts"],"map":"{\"version\":3,\"file\":\"RxnArrowResize.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../../src/application/editor/operations/rxn/RxnArrowResize.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/node_modules/.cache/rollup-plugin-typescript2/placeholder/application/editor/operations/rxn/RxnArrowResize.d.ts","writeByteOrderMark":false,"text":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport Base from '../base';\r\nimport { Vec2 } from \"../../../../domain/entities\";\r\ninterface RxnArrowResizeData {\r\n    id: number;\r\n    d: any;\r\n    current: Vec2;\r\n    anchor: Vec2;\r\n    noinvalidate: boolean;\r\n}\r\nexport declare class RxnArrowResize extends Base {\r\n    data: RxnArrowResizeData;\r\n    constructor(id: number, d: any, current: Vec2, anchor: any, noinvalidate: boolean);\r\n    execute(restruct: any): void;\r\n    invert(): Base;\r\n}\r\nexport {};\r\n"}}
