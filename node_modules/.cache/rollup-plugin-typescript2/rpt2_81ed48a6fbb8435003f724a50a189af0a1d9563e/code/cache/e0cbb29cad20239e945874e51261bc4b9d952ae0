{"code":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { Vec2 } from \"../../domain/entities\";\r\nimport assert from 'assert';\r\nfunction tfx(v) {\r\n    return parseFloat(v).toFixed(8);\r\n}\r\nfunction relBox(box) {\r\n    return {\r\n        x: box.x,\r\n        y: box.y,\r\n        width: box.width,\r\n        height: box.height\r\n    };\r\n}\r\n/**\r\n * Finds intersection of a ray and a box and\r\n * Returns the shift magnitude to avoid it\r\n * @param p { Vec2 }\r\n * @param d { Vec2 }\r\n * @param bb { Box2Abs }\r\n */\r\nfunction shiftRayBox(p, d, bb) {\r\n    assert(!!p);\r\n    assert(!!d);\r\n    assert(!!bb);\r\n    // four corner points of the box\r\n    const b = [\r\n        bb.p0,\r\n        new Vec2(bb.p1.x, bb.p0.y),\r\n        bb.p1,\r\n        new Vec2(bb.p0.x, bb.p1.y)\r\n    ];\r\n    const r = b.map((v) => v.sub(p)); // b relative to p\r\n    d = d.normalized();\r\n    const rc = r.map((v) => Vec2.cross(v, d)); // cross prods\r\n    const rd = r.map((v) => Vec2.dot(v, d)); // dot prods\r\n    // find foremost points on the right and on the left of the ray\r\n    let pid = -1;\r\n    let nid = -1;\r\n    for (let i = 0; i < 4; ++i) {\r\n        if (rc[i] > 0) {\r\n            if (pid < 0 || rd[pid] < rd[i])\r\n                pid = i;\r\n        }\r\n        else if (nid < 0 || rd[nid] < rd[i]) {\r\n            nid = i;\r\n        }\r\n    }\r\n    if (nid < 0 || pid < 0) {\r\n        // no intersection, no shift\r\n        return 0;\r\n    }\r\n    // check the order\r\n    const id0 = rd[pid] > rd[nid] ? nid : pid;\r\n    const id1 = rd[pid] > rd[nid] ? pid : nid;\r\n    // simple proportion to calculate the shift\r\n    /* eslint-disable no-mixed-operators */\r\n    return (rd[id0] +\r\n        (Math.abs(rc[id0]) * (rd[id1] - rd[id0])) /\r\n            (Math.abs(rc[id0]) + Math.abs(rc[id1])));\r\n}\r\nfunction calcCoordinates(aPoint, bPoint, lengthHyp) {\r\n    const obj = { pos1: null, pos2: null };\r\n    const oPos2 = { x: bPoint.x - aPoint.x, y: bPoint.y - aPoint.y };\r\n    const c = (lengthHyp ** 2 - oPos2.x * oPos2.x - oPos2.y * oPos2.y - lengthHyp ** 2) /\r\n        -2;\r\n    const a = oPos2.x * oPos2.x + oPos2.y * oPos2.y;\r\n    if (oPos2.x !== 0) {\r\n        const b = -2 * oPos2.y * c;\r\n        const e = c * c - lengthHyp * lengthHyp * oPos2.x * oPos2.x;\r\n        const D = b * b - 4 * a * e;\r\n        if (D > 0) {\r\n            obj.pos1 = { x: 0, y: 0 };\r\n            obj.pos2 = { x: 0, y: 0 };\r\n            obj.pos1.y = (-b + Math.sqrt(D)) / (2 * a);\r\n            obj.pos2.y = (-b - Math.sqrt(D)) / (2 * a);\r\n            obj.pos1.x = (c - obj.pos1.y * oPos2.y) / oPos2.x;\r\n            obj.pos2.x = (c - obj.pos2.y * oPos2.y) / oPos2.x;\r\n        }\r\n    }\r\n    else {\r\n        obj.pos1 = { x: 0, y: 0 };\r\n        obj.pos2 = { x: 0, y: 0 };\r\n        obj.pos1.y = c / oPos2.y;\r\n        obj.pos2.y = c / oPos2.y;\r\n        obj.pos1.x = -Math.sqrt(lengthHyp ** 2 - c ** 2 / oPos2.y ** 2);\r\n        obj.pos2.x = Math.sqrt(lengthHyp ** 2 - c ** 2 / oPos2.y ** 2);\r\n    }\r\n    if (obj.pos1 !== null) {\r\n        obj.pos1.x += aPoint.x;\r\n        obj.pos1.y += aPoint.y;\r\n    }\r\n    if (obj.pos2 !== null) {\r\n        obj.pos2.x += aPoint.x;\r\n        obj.pos2.y += aPoint.y;\r\n    }\r\n    return obj;\r\n}\r\nconst util = {\r\n    tfx,\r\n    relBox,\r\n    shiftRayBox,\r\n    calcCoordinates\r\n};\r\nexport default util;\r\n//# sourceMappingURL=util.js.map","references":["/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/src/domain/entities/index.ts","/usr/local/google/home/waich/workspace/ketcher/node_modules/assert/build/assert.js"],"map":"{\"version\":3,\"file\":\"util.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/application/render/util.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/node_modules/.cache/rollup-plugin-typescript2/placeholder/application/render/util.d.ts","writeByteOrderMark":false,"text":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\ndeclare function tfx(v: any): string;\r\ndeclare function relBox(box: any): {\r\n    x: any;\r\n    y: any;\r\n    width: any;\r\n    height: any;\r\n};\r\n/**\r\n * Finds intersection of a ray and a box and\r\n * Returns the shift magnitude to avoid it\r\n * @param p { Vec2 }\r\n * @param d { Vec2 }\r\n * @param bb { Box2Abs }\r\n */\r\ndeclare function shiftRayBox(p: any, d: any, bb: any): number;\r\ndeclare function calcCoordinates(aPoint: any, bPoint: any, lengthHyp: any): {\r\n    pos1: null | {\r\n        x: number;\r\n        y: number;\r\n    };\r\n    pos2: null | {\r\n        x: number;\r\n        y: number;\r\n    };\r\n};\r\ndeclare const util: {\r\n    tfx: typeof tfx;\r\n    relBox: typeof relBox;\r\n    shiftRayBox: typeof shiftRayBox;\r\n    calcCoordinates: typeof calcCoordinates;\r\n};\r\nexport default util;\r\n"}}
